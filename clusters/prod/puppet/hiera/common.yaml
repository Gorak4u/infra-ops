---
# Hiera Data for prod
# Hierarchy: common.yaml

# --- Cassandra Core ---
cassandra::cluster_name: "prod"
cassandra::seeds: []
cassandra::num_tokens: 256
cassandra::partitioner: "org.apache.cassandra.dht.Murmur3Partitioner"
cassandra::endpoint_snitch: "GossipingPropertyFileSnitch"

# --- Performance Tuning (Auto-Calculated) ---
cassandra::settings:
  concurrent_reads: 64
  concurrent_writes: 64
  concurrent_counter_writes: 32
  memtable_allocation_type: "offheap_objects"
  file_cache_size_in_mb: 16384 # 25% of RAM in MB
  inter_dc_tcp_nodelay: true

# --- JVM Settings ---
cassandra::jvm_options: |
  -Xms32G
  -Xmx32G
  -XX:+UseG1GC
  -XX:+AlwaysPreTouch
  -XX:+ResizeTLAB
  -XX:+UseNUMA

cassandra::heap:
  min: "32G"
  max: "32G"

# --- Backup Policy ---
backup::enabled: true
backup::schedule:
  full: "0 0 * * 0"
  incremental: "0 * * * *"
  retention_days: 7
  destination: "s3://omnicloud-backups/prod/"

# --- Monitoring ---
monitoring::enabled: true
monitoring::endpoints:
  prometheus: ":9100"
  jmx: ":7199"
